;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; Contexts
;

(in iptools
	(filecon "/etc/iproute2(/.*)?" any config_file_context)
	(filecon "/usr/sbin/ethtool" file cmd_file_context)
	(filecon "/usr/sbin/ifconfig" file cmd_file_context)
	(filecon "/usr/sbin/ip" file cmd_file_context)
	(filecon "/usr/sbin/iw" file cmd_file_context)
	(filecon "/usr/sbin/iwconfig" file cmd_file_context)
	(filecon "/usr/sbin/iwpriv" file cmd_file_context)
	(filecon "/usr/sbin/route" file cmd_file_context)
	(filecon "/usr/sbin/tc" file cmd_file_context)
	(filecon "/var/run/netns(/.*)?" any runtime_file_context))

;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; Macros
;

(in iptools
	(blockinherit exec_blk)

	(blockinherit auto_subj_type_transition_blk)

	(blockinherit run_blk)

	(blockinherit subj.send_signal_blk)

	(blockinherit file.search_config_blk)
	(blockinherit file.list_config_blk)
	(blockinherit file.read_config_files_blk)
	(blockinherit file.read_config_lnk_files_blk)
	(blockinherit file.read_config_blk)
	(blockinherit file.manage_config_blk)
	(blockinherit file.relabel_config_blk)

	(blockinherit file.search_runtime_blk)
	(blockinherit file.list_runtime_blk)
	(blockinherit file.read_runtime_files_blk)
	(blockinherit file.read_runtime_lnk_files_blk)
	(blockinherit file.read_runtime_blk)
	(blockinherit file.manage_runtime_blk)
	(blockinherit file.relabel_runtime_blk)

	(macro runtime_obj_type_transition_runtime ((type ARG1))
		(call file.runtime_obj_type_transition (ARG1 runtime_file dir
			"netns"))))

;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; Policy
;

(block iptools
	(roleattribute role_attribute)

	(blockinherit app.application_blk)

	(roleattributeset role_attribute sys.role)

	(roletype role_attribute subj)

	(blockinherit file.config_obj_blk)

	(call read_config (subj))

	(blockinherit file.runtime_obj_blk)

	(call manage_runtime (subj))
	(allow subj runtime_file (dir (mounton)))
	(call runtime_obj_type_transition_runtime (subj))

	(allow subj self (capability (net_admin)))
	(allow subj self create_udp_socket_perms)
	(allow subj self create_netlink_route_socket_perms)
	(allow subj self create_netlink_generic_socket_perms)
	(allow subj self create_unix_dgram_socket_perms)

	(call sys.load_kernel_module_subj_type (subj))
	(call sys.read_net_proc_files (subj))
	(call sys.read_net_sysctl_files (subj))
	(call sys.request_load_module (subj))

	(call file.read_config_files (subj))

	(call fs.read_nsfs_files (subj))
	(call fs.unmount_nsfs_fs (subj))

	(call locale.client_subj_type (subj))

	(call nss.client_subj_type (subj))

	(optional iptools_optional_sd
		(call sd.forked_subj_type (subj))))
