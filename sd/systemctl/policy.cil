(roleattribute systemctl_role)

(typeattribute systemctl_subj_type)
(typeattribute systemctl_client_subj_type)

(block systemctl
	(blockinherit systemctl_subj_blk)

	(blockinherit app.application_cmd_obj_blk)

	(call subj_entry (systemctl_subj_type cmd_file))

	(roletype systemctl_role subj)

	(call sd.daemon (subj cmd_file))

	(optional systemctl_optional_rpm
		(call rpm_script_client_subj_type (subj))))

(allow systemctl_subj_type self (capability (dac_override sys_chroot net_admin sys_resource setgid setuid sys_admin)))
(allow systemctl_subj_type self (process (setfscreate)))

(call sys_read_state_files (systemctl_subj_type))

(call fs_getattr_tmpfs_fs (systemctl_subj_type))
(call fs_write_inherited_devpts_chr_files (systemctl_subj_type))

(call term_use_inherited_console (systemctl_subj_type))

(call app.getattr (systemctl_subj_type))
(call app.read_state (systemctl_subj_type))

(call miscfile_read_utmp_runtime_files (systemctl_subj_type))

(call nss_client_subj_type (systemctl_subj_type))

(call sd.control_all_unit (systemctl_subj_type))
(call sd.getattr (systemctl_subj_type))
(call sd.control (systemctl_subj_type))
(call sd.getattr_forked_subj (systemctl_subj_type))
(call sd.manage_all_unit (systemctl_subj_type))
(call sd.read_state (systemctl_subj_type))
(call sd.read_state_forked_subj (systemctl_subj_type))
(call sd.stream_connect (systemctl_subj_type))
(call sd.control_unit_transient (systemctl_subj_type))

(call sd_logind_read_runtime (systemctl_subj_type))
(call sd_logind_client_subj_type (systemctl_subj_type))

(call sd_machined_read_runtime (systemctl_subj_type))

(call sd_nspawn_list_all_container (systemctl_subj_type))
(call sd_nspawn_read_all_container_lnk_files (systemctl_subj_type))
(call sd_nspawn_stream_connect_all_container_subj (systemctl_subj_type))
(call sd_nspawn_read_state_all_container_subj (systemctl_subj_type))

(call sduser.control_all_subj (systemctl_subj_type))
(call sduser.control_unit_transient_all_subj (systemctl_subj_type))
(call sduser.control_home_config (systemctl_subj_type))
(call sduser.control_all_unit (systemctl_subj_type))
(call sduser.control_unit_runtime (systemctl_subj_type))
(call sduser.stream_connect_all_subj (systemctl_subj_type))
(call sduser.manage_home_config (systemctl_subj_type))
(call sduser.home_config_obj_type_transition_home_config (systemctl_subj_type))

(call systemctl_client_subj_type (systemctl_subj_type))

(call usersubj.create_home_config_dirs (systemctl_subj_type))
(call usersubj.home_dir_add_obj_type_transition_home_config (systemctl_subj_type))
(call usersubj.home_dir_obj_type_transition_home_user_files (systemctl_subj_type))
(call usersubj.manage_home_user_files (systemctl_subj_type))

(tunableif enable_rbacsep
	(true
		(call rbacsep_read_state_source_subj_type (systemctl_subj_type))))

(optional systemctl_subj_type_optional_plymouth
	(call plymouth_use_fd_plymouthd (systemctl_subj_type)))

(allow systemctl_client_subj_type self (capability (ipc_lock)))
(allow systemctl_client_subj_type self (process (setrlimit)))
(allow systemctl_client_subj_type self rw_fifo_file_perms)

(call sys_read_crypto_sysctl_files (systemctl_client_subj_type))
(call sys_read_kernel_sysctl_files (systemctl_client_subj_type))
(call sys_use_fd (systemctl_client_subj_type))

(call cmd_exec_cmd (systemctl_client_subj_type))

(call dev_read_urandom (systemctl_client_subj_type))

(call file_read_config_files (systemctl_client_subj_type))

(call fs_getattr_fs (systemctl_client_subj_type))
(call fs_read_sysfs_files (systemctl_client_subj_type))
(call fs_read_cgroup (systemctl_client_subj_type))

(call miscfile_read_all_terminfo (systemctl_client_subj_type))
(call miscfile_read_locale (systemctl_client_subj_type))

(call sd.read_state_lnk_files (systemctl_client_subj_type))
(call sd.search_unit_runtime (systemctl_client_subj_type))
(call sd.sysbus_chat_client_subj_type (systemctl_client_subj_type))
(call sd.use_fd (systemctl_client_subj_type))

(call sd_journald.read_var_log (systemctl_client_subj_type))

(call sd_machined_read_config_files (systemctl_client_subj_type))

(optional systemctl_client_subj_type_optional_sysbus
	(call sysbus_client_subj_type (systemctl_client_subj_type)))
